package com.min.app02.controller;

import java.io.PrintWriter;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

@Controller
public class MvcController6 {

  @RequestMapping("/blog/list")
  public String list() {
    
    return "blog/list";  /* forward 이동할 땐 JSP 경로 작성 : /WEB-INF/views/ + news/list + .jsp */
    
  }
  
  @RequestMapping("/blog/register")
  public String register(RedirectAttributes rttr) {
    
    int result = Math.random() < 0.7 ? 1 : 0;
    
    rttr.addFlashAttribute("insertResult", result > 0 ? "블로그 등록 성공" : "블로그 등록 실패");
    
    return "redirect:/blog/list"; /* redirect 이동할 땐 Mapping 작성 : "/blog/list" */
    
  }
  
  @RequestMapping("/blog/modify")
  public void modify(HttpServletRequest request, HttpServletResponse response) {
    
    // 응답을 직접 만드는 방식
    try {
      
      response.setContentType("text/html; charset = UTF-8");
      PrintWriter out = response.getWriter();
      
      int result = Math.random() < 0.7 ? 1 : 0;
      
      out.println("<script>");
      if(result > 0) {
        out.println("alert('블로그 수정 성공')");
        out.println("location.href='" request.getContextPath() + "/blog/list'");
      } else {
        out.println("alert('블로그 수정 실패')");
      }
      out.println("</script>");
      out.close();
      
    } catch (Exception e) {
      e.printStackTrace();
    }
    
    
  }
  
}
